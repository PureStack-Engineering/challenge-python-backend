name: PureStack Technical Audit

# Se activa cuando el candidato hace Push o Pull Request a la rama main
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  audit-code:
    runs-on: ubuntu-latest
    name: "üïµÔ∏è‚Äç‚ôÇÔ∏è Engineering Audit Protocol"

    steps:
    # 1. Descargamos el c√≥digo del candidato
    - name: Checkout Candidate Code
      uses: actions/checkout@v3

    # 2. Preparamos Python (El entorno de ejecuci√≥n)
    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    # 3. Instalamos dependencias (Si fallan aqu√≠, suspenden por no saber configurar)
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        pip install pytest httpx  # Herramientas nuestras para corregir

    # 4. AUDITOR√çA DE ESTILO (Clean Code)
    # Si el c√≥digo es sucio, falla aqu√≠.
    - name: Lint with Flake8 (Clean Code Check)
      run: |
        pip install flake8
        # stop the build if there are Python syntax errors or undefined names
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics

    # 5. EJECUCI√ìN DE TESTS (El Examen Real)
    # Aqu√≠ ejecutamos sus propios tests (deben tenerlos) O los nuestros secretos
    - name: Run Test Suite
      id: run_tests
      run: |
        pytest --verbose --junitxml=reports/result.xml
      continue-on-error: true # Dejamos que contin√∫e para dar el reporte final

    # 6. GENERACI√ìN DE INSIGNIA (El Badge)
    # Si todo ha ido bien, esto podr√≠a actualizar el README (avanzado)
    - name: Audit Verdict
      run: |
        if [ ${{ steps.run_tests.outcome }} == 'success' ]; then
          echo "‚úÖ PURESTACK AUDIT: PASSED. Candidate ready for manual review."
        else
          echo "‚ùå PURESTACK AUDIT: FAILED. Logic errors detected."
          exit 1
        fi
